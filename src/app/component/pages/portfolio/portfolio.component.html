<!-- == | Main Container Start ===== -->
<section class="portfolio section container" id="portfolio">
        <!-- == | Portfolio Section Start ===== -->
        <div class="row" role="heading">
            <div class="col d-flex align-items-center">
                <div class="section-title">
                    <h2 >{{ 'PORTFOLIO.Title' | translate }}</h2>
                </div>
            </div>
        </div>
        <div class="row" role="rowgroup">
            <div class="col">
                <div class="portfolio-head">
                    <h2 class="mb-0">{{ 'PORTFOLIO.Subtitle' | translate }}:</h2>
                </div>
            </div>
        </div>
        
        <!-- Controles de filtro y vista -->
        <div class="row mt-4" role="toolbar" aria-label="Controles de portafolio">
            <div class="col-12">
                <div class="portfolio-controls d-flex flex-column flex-lg-row justify-content-between align-items-center gap-3">
                    
                    <!-- Filtros por tecnología -->
                    <div class="filter-section">
                        <label class="filter-label me-3" for="technology-filter">
                            {{ 'PORTFOLIO.FilterBy' | translate }}:
                        </label>
                        <div class="filter-buttons d-flex flex-wrap gap-2" role="group" aria-label="Filtros de tecnología">
                            <button 
                                class="btn filter-btn"
                                [class.active]="selectedFilter === 'all'"
                                (click)="filterByTechnology('all')"
                                type="button"
                                aria-label="Mostrar todos los proyectos"
                            >
                                {{ 'PORTFOLIO.All' | translate }} ({{ projectItems.length }})
                            </button>
                            <button 
                                class="btn filter-btn"
                                *ngFor="let tech of availableTechnologies"
                                [class.active]="selectedFilter === tech"
                                (click)="filterByTechnology(tech)"
                                type="button"
                                [attr.aria-label]="'Filtrar proyectos por ' + tech"
                            >
                                {{ tech }} ({{ getTechCount(tech) }})
                            </button>
                        </div>
                    </div>
                    
                    <!-- Selector de vista -->
                    <div class="view-controls d-flex align-items-center gap-2">
                        <span class="view-label">{{ 'PORTFOLIO.View' | translate }}:</span>
                        <div class="btn-group view-toggle" role="group" aria-label="Modo de vista">
                            <button 
                                class="btn view-btn"
                                [class.active]="viewMode === 'grid'"
                                (click)="viewMode = 'grid'"
                                type="button"
                                aria-label="Vista en cuadrícula"
                            >
                                <i class="fas fa-th" aria-hidden="true"></i>
                            </button>
                            <button 
                                class="btn view-btn"
                                [class.active]="viewMode === 'list'"
                                (click)="viewMode = 'list'"
                                type="button"
                                aria-label="Vista en lista"
                            >
                                <i class="fas fa-list" aria-hidden="true"></i>
                            </button>
                        </div>
                        <span class="project-count text-muted">
                            {{ getFilteredProjectsCount() }} {{ 'PORTFOLIO.Projects' | translate }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Lista de proyectos con animación de filtrado -->
        <div class="row mt-4" 
             [class.filtering-active]="isFilteringActive"
             [class.view-grid]="viewMode === 'grid'"
             [class.view-list]="viewMode === 'list'"
             role="rowgroup">
            
            <!-- Mensaje de carga durante filtrado -->
            <div class="col-12 text-center" *ngIf="isFilteringActive">
                <div class="filtering-loader">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Filtrando proyectos...</span>
                    </div>
                    <p class="mt-2">{{ 'PORTFOLIO.Filtering' | translate }}...</p>
                </div>
            </div>
            
            <!-- Proyectos filtrados -->
            <div class="projects-container"
                 [class.row-cols-1]="viewMode === 'list'"
                 [class.row-cols-md-2]="viewMode === 'grid'"
                 [class.row-cols-xxl-3]="viewMode === 'grid'"
                 [class.g-4]="viewMode === 'grid'"
                 [class.g-2]="viewMode === 'list'"
                 [style.display]="isFilteringActive ? 'none' : 'flex'"
                 style="flex-wrap: wrap;">
                
                <div class="project-item"
                     [class.col]="viewMode === 'grid'"
                     [class.col-12]="viewMode === 'list'"
                     [class.list-item]="viewMode === 'list'"
                     [class.grid-item]="viewMode === 'grid'"
                     *ngFor="let project of filteredProjects; let index=index; trackBy: trackByProjectId"
                     [@slideInAnimation]>

                <article 
                    class="card bg-card text-center project-card"
                    [class.list-card]="viewMode === 'list'"
                    [class.grid-card]="viewMode === 'grid'"
                    role="article"
                    [attr.aria-labelledby]="'project-title-' + index"
                    [attr.aria-describedby]="'project-desc-' + index"
                >
                    <header class="card-header">
                        <h3 [id]="'project-title-' + index">{{project.getTitle}}</h3>
                    </header>
                    <p class="d-flex flex-wrap justify-content-center py-2 bg-important">
                        {{ project.getOwner | translate }}
                    </p>
                    <div class="image-container" 
                         style="overflow: hidden; position: relative; cursor: pointer;"
                         (click)="dataModal(index)"
                         (keydown.enter)="dataModal(index)"
                         tabindex="0"
                         [attr.aria-label]="'Ver detalles del proyecto ' + project.getTitle"
                    >
                        <!-- Skeleton loader -->
                        <div class="image-skeleton" 
                             [class.hidden]="imageStates[index].loaded"
                             style="pointer-events: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;">
                        </div>
                        
                        <!-- Imagen principal -->
                        <img 
                            class="card-img-top img-aspect" 
                            [src]="project.getUrlMainImage" 
                            [alt]="'Imagen del proyecto: ' + project.getTitle"
                            loading="lazy"
                            [class.loaded]="imageStates[index].loaded"
                            [class.error]="imageStates[index].error"
                            (load)="onImageLoad(index)"
                            (error)="onImageError(index)"
                            style="position: relative; z-index: 2; width: 100%; height: 100%; object-fit: cover;"
                        >
                        
                        <!-- Imagen de error fallback -->
                        <div 
                            class="error-placeholder" 
                            [class.show]="imageStates[index].error"
                            [attr.aria-label]="'Error al cargar imagen del proyecto ' + project.getTitle"
                            style="pointer-events: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3;"
                        >
                            <i class="fas fa-image" aria-hidden="true"></i>
                            <span>Error al cargar imagen</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p [id]="'project-desc-' + index">{{ project.getTranslateDescription | translate }}</p>
                        <div class="technology-tags" role="list" [attr.aria-label]="'Tecnologías utilizadas en ' + project.getTitle">
                            <span 
                                class="tag-tecnology" 
                                *ngFor="let technologies of project.getTechnologies"
                                role="listitem"
                                [attr.aria-label]="'Tecnología: ' + technologies"
                            >{{technologies}}</span>
                        </div>
                    </div>
                    <footer class="card-footer card-text-muted d-flex justify-content-between">
                        <small>{{ project.getTranslateYearsExpirience | translate:project }}</small>
                        <button 
                            class="modalOpenButton btn-link" 
                            (click)="dataModal(index)"
                            [attr.aria-label]="'Ver detalles completos del proyecto ' + project.getTitle"
                            type="button"
                        >
                            <i class="fa-solid fa-square-up-right" aria-hidden="true"></i>
                            <span class="sr-only">Ver detalles</span>
                        </button>
                    </footer>
                </article>

                </div>
            </div>
        </div>
        <!-- == | Portfolio Section End ===== -->
</section>

<!-- The Modal -->
<div 
    class="modal fade" 
    id="myModal" 
    role="dialog" 
    aria-modal="true"
    [attr.aria-labelledby]="'modal-title'"
    [attr.aria-describedby]="'modal-description'"
    tabindex="-1"
    (click)="onModalBackdropClick($event)"
    (keydown)="onKeyDown($event)"
>
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <dialog class="modal-content bg-modal" (click)="$event.stopPropagation()">
  
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 id="modal-title" class="modal-title">{{projecyModal.getTitle}}</h4>
                <button 
                    type="button" 
                    class="btn-close" 
                    (click)="closeModal()"
                    aria-label="Cerrar modal"
                ></button>
            </div>
    
            <!-- Modal body -->
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-8 d-flex align-items-center">

                            <carousel 
                                [(activeSlide)]="activeSlideIndex" 
                                [interval]="myInterval"
                                [showIndicators]="false"
                                class="project-carousel"
                                role="region"
                                aria-label="Galería de imágenes del proyecto"
                                >
                                <slide class="carousel-dark">
                                    <img 
                                        [src]="projecyModal.getUrlMainImage" 
                                        [alt]="'Imagen principal del proyecto: ' + projecyModal.getTitle" 
                                        class="img-aspect" 
                                        style="display: block; width: 100%;"
                                    >
                                    <div class="carousel-caption d-none d-md-block main-image p-0 text-white" >
                                        <h3>{{projecyModal.getTitle}}</h3>
                                        <p>{{ projecyModal.getTranslateSubTitle | translate }}</p>
                                    </div>
                                </slide>
                                <slide *ngFor="let slide of projecyModal.getUrlImages; let slideIndex=index">
                                    <img 
                                        [src]="slide" 
                                        [alt]="'Imagen ' + (slideIndex + 2) + ' del proyecto ' + projecyModal.getTitle" 
                                        class="img-aspect" 
                                        style="display: block; width: 100%;"
                                    >
                                
                                    <div class="carousel-caption text-dark">
                                        <h4></h4>
                                        <p></p>
                                    </div>
                                </slide>
                            </carousel>

                        </div>
                        <div class="col-md-4">

                            <div class="row mb-3" >
                                <p id="modal-description">{{ projecyModal.getTranslateDescription | translate }}</p>
                                <h6>{{ "PORTFOLIO.OwnerText" | translate }}: {{ projecyModal.getOwner | translate }}</h6>
                            </div>
                            <div class="row">
                                <div class="card tecnology-card" style="margin:10px; width: 100%;">
                                    <header class="card-header">
                                        <h5>{{ "PORTFOLIO.TechnologiesText" | translate }}</h5>
                                    </header>
                                    <div 
                                        class="card-body technology-tags"
                                        role="list"
                                        [attr.aria-label]="'Tecnologías utilizadas en el proyecto ' + projecyModal.getTitle"
                                    >
                                        <span 
                                            class="tag-tecnology" 
                                            *ngFor="let technologies of projecyModal.getTechnologies"
                                            role="listitem"
                                            [attr.aria-label]="'Tecnología: ' + technologies"
                                        >{{technologies}}</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
    
            <!-- Modal footer -->
            <footer class="modal-footer">
                <a 
                    *ngIf="projecyModal.getUrlRepository" 
                    [href]="projecyModal.getUrlRepository" 
                    rel="noreferrer noopener" 
                    target="_blank" 
                    class="btn bttn-repository" 
                    placement="top" 
                    tooltip="Repository" 
                    containerClass="tooltipPorfolio"
                    [attr.aria-label]="'Ver repositorio del proyecto ' + projecyModal.getTitle + ' en ' + (projecyModal.getUrlRepository.includes('gitlab') ? 'GitLab' : 'GitHub') + ' (se abre en nueva ventana)'"
                >
                    <i [class]="projecyModal.getIconRepository" aria-hidden="true"></i>
                    <span class="sr-only">Repositorio</span>
                </a>
                <a 
                    *ngIf="projecyModal.getUrlProject" 
                    [href]="projecyModal.getUrlProject" 
                    rel="noreferrer noopener" 
                    target="_blank" 
                    class="btn bttn-repository" 
                    placement="top" 
                    tooltip="Website" 
                    containerClass="tooltipPorfolio"
                    [attr.aria-label]="'Visitar sitio web del proyecto ' + projecyModal.getTitle + ' (se abre en nueva ventana)'"
                >
                    <i class="fa-solid fa-link" aria-hidden="true"></i>
                    <span class="sr-only">Sitio web</span>
                </a>
            </footer>
  
        </dialog>
    </div>
  </div>

<!-- == | Main Container End ===== -->